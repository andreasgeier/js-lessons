<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <style>
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/materialicons/v50/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');
        }
        * {
            font-family: 'Segoe UI', sans-serif;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
        }
        .container {
            position: absolute;
            background-color: white;
            top: 20px;
            left: 50%;
            transform: translate(-50%);
            padding: 10px;
            width: 410px;
            box-shadow: 0px 0px 10px lightgray;
            border-radius: 10px;
        }
        .outputbox {
            width: 97.1%;
            height: 77px;
            border: 1px solid #dfe1e5;
            border-radius: 4px;
            margin: 6px;
        }
        .icon{
            z-index: 4;
            visibility: hidden;
            user-select: none;
            position: relative;
            float: left;
            left: 16px;
            top: 14px;
            height: auto;
            color: rgb(112, 112, 112);
        }
        .icon:hover{
            color: black;
        }
        .historyicon {
            pointer-events: none;
            -moz-osx-font-smoothing: grayscale;
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 22px;
            z-index: 3;
        }
        .historyouter{
            z-index: 3;
            user-select: none;
            padding-top: 40px;
            position: absolute;
            border: 1px solid lightgray;
            width: 300px;
            background-color: white;
            border-radius: 10px;
            height: auto;
            box-shadow: 0px 0px 10px lightgray;

        }
        .historyinner{
            position: relative;
            width: auto;
            max-height: 260px;
            overflow: auto;
        }
        .historyitm{
            display: flex;
            justify-content: left;
            margin: 10px
        }
        .historyitm span{
            line-height: 29px;
            color: gray;
            width: auto;
        }
        .historyBtn{
            width: auto;
            background-color: white;
            padding: 6px 10px 6px 10px;
            margin: 0px 5px 0px 5px;
            border: 1px solid lightgray;
            border-radius: 6px;
            cursor: pointer;
            color: dodgerblue;
        }
        .historyBtn:nth-child(1){
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .historyBtn:nth-child(3){
            max-width: 90px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .historyBtn:hover{
            background-color: rgb(233, 233, 233);
        }
        .historyBtn:active{
            background-color: rgba(45, 118, 255, 0.158);
        }
        .calculation {
            margin: 8px 6px 0px 50px;
            height: 20px;
            text-align: right;
            padding-right: 10px;
            font-size: 15px;
            color: #70757a;
        }

        .output {
            overflow: hidden;
            margin: 0px 6px 4px 6px;
            height: 45px;
            font-size: 30px;
            line-height: 38px;
            width: 95%;
        }

        .output #output {
            user-select: text;
            white-space: nowrap;
            float: right;
            user-select: text;
            float: right;
            white-space: nowrap;
        }

        .outputbox:hover {
            border-color: rgb(163, 163, 163);
        }

        .btn {
            cursor: pointer;
            width: 87px;
            margin: 4px;
        }

        .char {
            user-select: none;
            text-align: center;
            line-height: 36px;
            border: 1px;
            color: #202124;
            border-radius: 4px;
        }

        .number {
            background: #f1f3f4;
            border: 1px solid #f1f3f4;
        }

        .operator {
            background: #dfe1e5;
            border: 1px solid #dfe1e5;
        }

        .number:hover {
            background: #e0e0e0;
        }

        .operator:hover {
            background: #ced0d4;
        }

        .number:active {
            border-color: rgb(163, 163, 163);
        }

        .operator:active {
            border-color: gray;
        }

        .equal {
            background: #4285f4;
            color: #fff;
            border: 1px solid #4285f4;
        }

        .equal:hover {
            background: #5a96f6;
        }

        .equal:active {
            border-color: #0054fd;
            box-shadow: 0px 0px 5px #4285f4;
        }
    </style>
</head>


<body>
    <div class="container">
        <div class="icon" id="icon"><i class="historyicon" id="icon">history</i></div>
        <div class="historyouter" id="history" style="display: none;">
            <div class="historyinner" id="historyinner">
            </div>
        </div>
            <div class="outputbox">
            <div class="calculation">
                <span id="calculation">
                </span>
            </div>
            <div class="output">
                <span id="output">
                </span>
            </div>
        </div>
        <table>
            <tr>
                <td>
                    <div class="btn">
                        <div class="char number" id="7">7</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char number" id="8">8</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char number"  id="9">9</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char operator" id="รท">รท</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="btn">
                        <div class="char number" id="4">4</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char number" id="5">5</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char number" id="6">6</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char operator" id="x">x</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="btn">
                        <div class="char number" id="1">1</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char number" id="2">2</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char number" id="3">3</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char operator" id="-">-</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="btn">
                        <div class="char number" id="0">0</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char operator" id="AC" >AC</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char equal" id="=">=</div>
                    </div>
                </td>
                <td>
                    <div class="btn">
                        <div class="char operator" id="+">+</div>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <script>
        'use strict'

        // Helper
        const getElementById = id => document.getElementById(id)

        // Get both fields for calculation
        const OUTPUT = getElementById('output')
        const CALCULATION = getElementById('calculation')
        
        // Define history
        const historyContainer = getElementById('history')
        const historyIcon = getElementById('icon')
        const historyInner = getElementById('historyinner')
        const history = []
        let historyIndex = null

        // Calculate
        function calculate() {
            let a = OUTPUT.innerHTML
            history.push(a)
            CALCULATION.innerHTML = OUTPUT.innerHTML + ' ='
            OUTPUT.innerHTML = eval(OUTPUT.innerHTML)
            let b = OUTPUT.innerHTML
            history.push(b)
            historyIndex = history.length - 1
            historyAdd(a, b, historyIndex - 1, historyIndex)

            // make history icon only visible if history exists
            if (historyIndex > 0) historyIcon.style.visibility = 'visible'
        }

        // Add event listener to calculator buttons
        /* function addButtonEventListeners() {
            getElementById('0').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '0'),
            )
            getElementById('1').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '1'),
            )
            getElementById('2').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '2'),
            )
            getElementById('3').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '3'),
            )
            getElementById('4').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '4'),
            )
            getElementById('5').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '5'),
            )
            getElementById('6').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '6'),
            )
            getElementById('7').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '7'),
            )
            getElementById('8').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '8'),
            )
            getElementById('9').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '9'),
            )
            getElementById('รท').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '/'),
            )
            getElementById('x').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '*'),
            )
            getElementById('+').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '+'),
            )
            getElementById('-').addEventListener(
                'click',
                () => (OUTPUT.innerHTML += '-'),
            )
            getElementById('=').addEventListener('click', () => calculate())
            getElementById('AC').addEventListener('click', () => {
                OUTPUT.innerHTML = ''
                CALCULATION.innerHTML = ''
            })
            historyIcon.addEventListener('click', () => showHistory())
            document.addEventListener('click', e => {
                if (
                    e.target !== historyContainer &&
                    e.target !== historyIcon
                ) {
                    historyIcon.style.color = 'rgb(112, 112, 112)'
                    historyContainer.style.display = 'none'
                }
            })
        }
        */
        
        document.addEventListener(
            'click', (e) => {
                // show target attributes
                console.log(e.target)
                console.log('classList: ' + e.target.classList)
                console.log('id: ' + e.target.id)

                // calculator numbers
                if (e.target.textContent === '0') OUTPUT.innerHTML += '0'
                if (e.target.textContent === '1') OUTPUT.innerHTML += '1'
                if (e.target.textContent === '2') OUTPUT.innerHTML += '2'
                if (e.target.textContent === '3') OUTPUT.innerHTML += '3'
                if (e.target.textContent === '4') OUTPUT.innerHTML += '4'
                if (e.target.textContent === '5') OUTPUT.innerHTML += '5'
                if (e.target.textContent === '6') OUTPUT.innerHTML += '6'
                if (e.target.textContent === '7') OUTPUT.innerHTML += '7'
                if (e.target.textContent === '8') OUTPUT.innerHTML += '8'
                if (e.target.textContent === '9') OUTPUT.innerHTML += '9'

                // calculator operators
                if (e.target.textContent === 'รท') OUTPUT.innerHTML += ' / '
                if (e.target.textContent === 'x') OUTPUT.innerHTML += ' * '
                if (e.target.textContent === '+') OUTPUT.innerHTML += ' + '
                if (e.target.textContent === '-') OUTPUT.innerHTML += ' - '

                // calculator functions
                if (e.target.textContent === '=') calculate()
                if (e.target.textContent === 'AC') { 
                    OUTPUT.innerHTML = ''
                    CALCULATION.innerHTML = '' 
                }
                if (e.target.classList.contains('icon')) showHistory()
                if (e.target !== historyContainer && e.target !== historyIcon) {
                    historyIcon.style.color = 'rgb(112, 112, 112)'
                    historyContainer.style.display = 'none'
                }
            }
        )

        function keyHandler(event) {
            if (event.key == '0') OUTPUT.innerHTML += '0'
            if (event.key == '1') OUTPUT.innerHTML += '1'
            if (event.key == '2') OUTPUT.innerHTML += '2'
            if (event.key == '3') OUTPUT.innerHTML += '3'
            if (event.key == '4') OUTPUT.innerHTML += '4'
            if (event.key == '5') OUTPUT.innerHTML += '5'
            if (event.key == '6') OUTPUT.innerHTML += '6'
            if (event.key == '7') OUTPUT.innerHTML += '7'
            if (event.key == '8') OUTPUT.innerHTML += '8'
            if (event.key == '9') OUTPUT.innerHTML += '9'
            if (event.key == '+') OUTPUT.innerHTML += '+'
            if (event.key == '-') OUTPUT.innerHTML += '-'
            if (event.key == '*') OUTPUT.innerHTML += '*'
            if (event.key == '/') OUTPUT.innerHTML += '/'
            if (event.key == 'Escape') {
                OUTPUT.innerHTML = ''
                CALCULATION.innerHTML = ''
            }
            if (event.key == 'Enter') calculate()
            if (event.key == 'Backspace')
                OUTPUT.innerHTML = OUTPUT.innerHTML.substr(
                    0,
                    OUTPUT.innerHTML.length - 1,
                )
            if (event.key == 'ArrowUp') {
                OUTPUT.innerHTML = history[historyIndex - 1] ?? ''
                CALCULATION.innerHTML = history[historyIndex - 2] ?? ''
                historyIndex !== -1 ? historyIndex-- : null
            }
            if (event.key == 'ArrowDown') {
                OUTPUT.innerHTML = history[historyIndex + 1] ?? ''
                CALCULATION.innerHTML = history[historyIndex] ?? ''
                historyIndex !== history.length ? historyIndex++ : null
            }
        }

        function showHistory() {
            if (historyInner.innerHTML.replace(/\s/g, '') != '') {
                historyIcon.style.color = 'dodgerblue'
                historyContainer.style.display = 'block'
                historyBackDrop.style.display = 'block'
            }
        }

        function historyClickHandler(index) {
            if (index % 2 == 0) {
                OUTPUT.innerHTML = history[index] ?? ''
                CALCULATION.innerHTML = ''
            } else {
                OUTPUT.innerHTML = history[index] ?? ''
                CALCULATION.innerHTML = history[index - 1] + ' =' ?? ''
            }
            historyIndex = index
        }

        function historyAdd(a, b, indexA, indexB) {
            historyInner.innerHTML += `<div class="historyitm" id="historyitm"><div class="historyBtn" onclick="historyClickHandler(${indexA})">
            ${a}
            </div><span>=</span><div class="historyBtn" onclick="historyClickHandler(${indexB})">
            ${b}
            </div></div>`
        }

        // addButtonEventListeners()
        document.body.addEventListener('keydown', keyHandler)

        console.log('Hallo Welt')

    </script>
</body>

</html
